{"_id":"~82792504","_type":"CaseTemplate","_createdBy":"thehive@thehive.local","_updatedBy":"thehive@thehive.local","_createdAt":1758037146003,"_updatedAt":1758037146023,"name":"Azure Tenant Compromise ‚Äì Qualification","displayName":"","description":"# ‚òÅÔ∏è Azure Tenant Compromise ‚Äì Qualification\n\n---\n\n## üéØ Purpose\n\nConfirm or deny a compromise related to:\n\n* Accounts\n* Applications\n* Configuration\n\nThen assess the impact and prepare containment specific to **M365 / Entra / Azure**.\n\n---\n\n## ‚öôÔ∏è Prerequisites\n\n* üë• **Required personnel and resources**:\n  ‚Üí Access to IS administration and monitoring\n  ‚Üí Credentials for an Azure Entra ID ‚Äúglobal administrator‚Äù account\n  ‚Üí Access to security equipment\n  ‚Üí Internal or external resources, managed service provider available if needed\n* üìù **Actions already undertaken**: list past interventions and begin recording them in the incident log\n\n---\n\n## üìå Objectives\n\n1. Confirm the type of incident\n2. Assess the scope of the incident\n3. Measure the impact of the incident\n4. Determine the urgency of resolution\n\n---\n\n## üìÑ Resource\n\nüëâ [Full reflex sheet ‚Äì CERT-FR](https://www.intercert-france.fr/wp-content/uploads/2025/06/fichereflexe-compromissiontenantazure-qualification.pdf)","severity":1,"severityLabel":"LOW","tags":["m365","tenant","azure","entra ID","entra","qualification"],"flag":false,"tlp":2,"tlpLabel":"AMBER","pap":2,"papLabel":"AMBER","customFields":[],"tasks":[{"_id":"~82796600","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1758037146004,"title":"Measure 1 - Confirm the type of incident","group":"Qualification","description":"## üéØ Objective\n\nDetermine the type of incident by checking roles, sessions, authentication logs, permissions, mail flow, and related policies.\nRefer to the reflex sheet for detailed procedures, additional information, and diagrams.\nüëâ [Reflex sheet](https://www.intercert-france.fr/wp-content/uploads/2025/06/fichereflexe-compromissiontenantazure-qualification.pdf)\n\n---\n\n## üìå Actions\n\n* **Establish if the incident is a privileged account compromise in Microsoft 365 or Entra ID**\n\n  * **Check privileged users in Entra ID roles**\n\n    * Ensure at least **2** users have the **Global Administrator** role for resilience and recovery.\n    * Confirm all these accounts are **legitimate** and **active**.\n    * For contractor accounts, validate legitimacy through the internal directory.\n    * Verify that **MFA** is enabled for all.\n    * **Decision:** privileged account compromise confirmed or not?\n  * **Check privileged sessions**\n\n    * Analyze **IP addresses** of privileged account logins over several weeks (ideally **6 months**) from **Sign-in logs** in **Microsoft Entra**.\n\n      * If suspicious authentications:\n\n        * Reset the account **password** and **enforce MFA** if absent.\n        * **Terminate all active sessions** and force reauthentication.\n      * Export logs, sort by **Location**, then **Status = Failure**, then **date/time**.\n    * **Decision:** privileged account compromise confirmed or not?\n  * **Check privileged accounts synchronized between Active Directory and Entra ID**\n\n    * Ensure no **on-prem AD** synchronized account has **Entra ID privileged roles**.\n\n      * If any, analyze their **Sign-in logs** over several weeks (ideally **6 months**) and export for sorting (**Location**, **Status = Failure**, **date/time**).\n    * If possible, **disable** these accounts or at least **reset** their password and **enforce MFA** via Azure MFA console.\n    * **Decision:** privileged account compromise confirmed or not?\n  * **Handle ‚Äúrisky users‚Äù and Entra ID risks**\n\n    * Handle **risky users** flagged in **Microsoft Entra**.\n    * Handle **risks** affecting privileged accounts.\n\n      * In doubt, **consider the account compromised**, record UPNs, **reset password**, and **enforce MFA**.\n    * Handle **risky sign-ins** flagged in Entra ID for privileged accounts.\n    * **Decision:** privileged account compromise confirmed or not?\n\n---\n\n* **Confirm if the incident is a Microsoft 365 user account compromise**\n\n  * **Handle already suspected accounts**\n\n    * For any potentially compromised account, check if it appears in public breaches (e.g., **Have I Been Pwned**).\n    * Handle **risky sign-ins** and **risks** flagged by Entra ID.\n    * Handle **risky IPs** in **Microsoft Entra Health**.\n    * Record UPNs of compromised accounts, **reset passwords**, and **enable MFA**.\n    * **Decision:** user account compromise confirmed or not?\n  * **Check guest accounts**\n\n    * **Guest** policy set to: *‚ÄúGuest user access is restricted to properties and memberships of their own directory objects (most restrictive)‚Äù*.\n    * **Guest invitations**: *‚ÄúOnly users assigned to specific admin roles can invite guest users‚Äù*.\n    * Identify **guest accounts never authenticated** and verify legitimacy.\n    * **Decision:** user account compromise confirmed or not?\n  * **Check Exchange Online mailboxes**\n\n    * **Delegations** of suspect accounts‚Äô mailboxes: legitimate or not?\n    * Mailboxes **hidden** from the **GAL**.\n    * **External forwarding rules** active: legitimate or not?\n    * **SendAs delegates**: legitimate or not?\n    * **SendOnBehalfOf delegates**: legitimate or not?\n    * **Decision:** user account compromise confirmed or not?\n\n---\n\n* **Confirm if the incident is an unwanted relay**\n\n  * **Check anti-spam configuration**\n\n    * Tenant anti-spam policy: **Blocked Senders** and **Allowed Senders/Domains** legitimate.\n    * **Anti-spoofing policy**: authorized spoofing entities legitimate.\n    * **Decision:** unwanted relay confirmed or not?\n\n---\n\n* **Confirm if the incident is an Azure Entra enterprise application compromise**\n\n  * **Handle security anomalies tied to applications**\n\n    * Applications registered with **Certificate credentials** or **Client secret credentials**.\n    * Applications with **mailbox access permissions** (*unified audit logs*).\n    * **Application ownership changes** (*unified audit logs*).\n    * **Decision:** enterprise application compromise confirmed or not?\n  * **Check for illicit consent grant attack**\n\n    * Follow Microsoft‚Äôs **Detect and remediate illicit consent grants** procedure and generate the **CSV**.\n    * Analyze the CSV:\n\n      * **ConsentType** = `AllPrincipals`: check all **non-Microsoft** apps.\n      * **Permission**: identify **Read**, **Write**, or **All** permissions and validate.\n      * **Consents granted** by **VIP/VOP** users: investigate with priority.\n      * **ClientDisplayName**: look for suspicious names (misspellings, blanks, offensive tool names).\n    * **Decision:** enterprise application compromise confirmed or not?\n\n---\n\n* **Confirm if the incident is an information leak (including BEC)**\n\n  * **Check automatic forwards**\n\n    * Review **Auto forwarded message report**.\n    * For each account listed: verify legitimacy. If uncertain, consider the account **potentially compromised**.\n\n      * If the user shows no compromise signs, **suspect a privileged Exchange Online account** compromise.\n  * **Check Exchange Online transport rules**\n\n    * **Export** rules to **XML** (Exchange Online cmdlets).\n    * Review **conditions** and **recipients** for legitimacy.\n\n      * Server-side rules enable redirection, deletion, copying, header modifications. Attackers often abuse these.\n  * **Disable shared mailbox authentication**\n\n    * Best practice to avoid direct logins not traceable to a unique identity.\n  * **Check ‚ÄúRemoteDomain‚Äù**\n\n    * Ensure no **wildcards**.\n    * Recommended settings: **Delivery reports = allowed**, **Non-delivery report = allowed**, **Meeting forward notifications = blocked**.\n    * Command:\n\n      ```powershell\n      get-remotedomain *\n      ```\n  * **Check absence of authorized external storage provider**\n\n    * Command:\n\n      ```powershell\n      Get-OwaMailboxPolicy -Identity <affected policy>\n      ```\n  * **Check third-party storage policy in Microsoft Teams**\n\n    * Ensure no **illegitimate export to external storage** is allowed.\n  * **Check anonymous user authorization policy**\n\n    * Ensure it does not allow **illegitimate access**.\n  * **Conclude**\n\n    * **Decision:** information leak (including BEC) confirmed or not?\n    * If needed, refer to the InterCERT *Information Leak* reflex sheet.\n\n---\n\n## ‚úÖ Deliverables\n\n* Type of incident confirmed, scope and justification documented\n* Impacted accounts listed, measures applied: password reset, MFA enforced, sessions revoked\n* Exports and evidence preserved\n* Traceability: all actions recorded in the **activities** of this task","status":"Waiting","flag":false,"order":0,"mandatory":false,"extraData":{}},{"_id":"~205193384","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1758037146014,"title":"Measure 3 - Assess the impact of the incident","group":"Qualification","description":"### üéØ Objective\n\nDetect **malicious applications** or abusive consents.\n\n### üìå Actions\n\n* Assess impacts on business activity\n\n  * Is the Microsoft Entra ID service still operational?\n  * Is the Microsoft 365 Exchange Online service still operational?\n  * Is the Microsoft 365 Teams service still operational?\n  * Have sensitive data been confirmed as leaked?\n* Assess impacts on business continuity\n\n  * Does the organization still have a valid Microsoft Entra ID ‚Äúglobal administrator‚Äù account?\n  * In case of alteration or destruction of user data, are recent backups available (users, Entra ID, M365)?\n* Review *Enterprise Apps*, *Service Principals*, *Graph permissions*\n\n### ‚úÖ Deliverables\n\n* List of disrupted critical activities\n* List of available backups\n* All information recorded in the **activities** of this task","status":"Waiting","flag":false,"order":2,"mandatory":false,"extraData":{}},{"_id":"~205254784","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1758037146018,"title":"Measure 4 - Assess the urgency to resolve the incident","group":"Qualification","description":"### üéØ Objective\n\nEvaluate the urgency to resolve the incident.\n\n### üìå Actions\n\n* Is a Microsoft 365 or Entra ID privileged account confirmed compromised?\n* Assess the urgency to resolve the incident\n\n### ‚úÖ Deliverables\n\n* Urgency to resolve the incident\n* Urgency explicitly recorded in the **activities** of this task","status":"Waiting","flag":false,"order":3,"mandatory":false,"extraData":{}},{"_id":"~246186008","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1758037146009,"title":"Measure 2 - Assess the scope of the incident","group":"Qualification","description":"### üéØ Objective\n\nIdentify critical **accounts/roles** and related security incidents.\n\n### üìå Actions\n\n* Assess the extent of compromise within the Azure environment\n\n  * Is a Microsoft 365 or Entra ID privileged account confirmed compromised?\n  * Are user data (mailboxes, OneDrive, Teams spaces) altered or destroyed?\n* Assess the extent of compromise **outside** the Azure environment\n\n  * Are there external reports related to the security incident?\n  * Is on-premises Active Directory considered compromised?\n  * Are user devices (PCs, smartphones, tablets) considered potentially compromised?\n* Inventory Global Admin, App Admin, Exchange Admin, etc.\n* Check delegations, PIM groups, permanent access\n\n### ‚úÖ Deliverables\n\n* Scope mapped (Azure / outside Azure)\n* Impacted accounts listed (admins, VIPs, users)\n* All relevant information recorded in the **activities** of this task","status":"Waiting","flag":false,"order":1,"mandatory":false,"extraData":{}}],"extraData":{"pageTemplateHeaders":[]}}