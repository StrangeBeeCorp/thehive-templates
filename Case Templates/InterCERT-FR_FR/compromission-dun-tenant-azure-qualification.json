{"_id":"~124153952","_type":"CaseTemplate","_createdBy":"thehive@thehive.local","_updatedBy":"thehive@thehive.local","_createdAt":1755071175799,"_updatedAt":1757497585330,"name":"Compromission d'un tenant Azure - Qualification","displayName":"","description":"# ☁️ Compromission d’un tenant Azure – Qualification\n\n---\n\n## 🎯 Usage\nConfirmer ou non une compromission liée à :  \n- Comptes  \n- Applications  \n- Configuration  \n\nPuis estimer l’impact et préparer l’endiguement spécifique **M365 / Entra / Azure**.  \n\n---\n\n## ⚙️ Prérequis\n\n- 👥 **Personnes et ressources nécessaires** :  \n  → Accès administration et supervision du SI.  \n  → Identifiants d’un compte “administrateur global” Azure Entra ID.   \n  → Accès aux équipements de sécurité.  \n  → Ressources internes ou externes, infogérant mobilisable si besoin.  \n- 📝 **Actions déjà entreprises** : recenser les interventions passées et commencer à les reporter dans la main courante.  \n\n\n---\n\n## 📌 Objectifs\n\n1. Confirmer le type d’incident  \n2. Évaluer le périmètre de l’incident  \n3. Mesurer l’impact de l’incident  \n4. Déterminer l’urgence de la résolution  \n\n---\n\n## 📄 Ressource\n👉 [Fiche réflexe complète – CERT-FR](https://www.intercert-france.fr/wp-content/uploads/2025/06/fichereflexe-compromissiontenantazure-qualification.pdf)","severity":2,"severityLabel":"MEDIUM","tags":["m365","tenant-azure","qualification","entra-id"],"flag":false,"customFields":[],"tasks":[{"_id":"~41316504","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757497585326,"title":"Mesure 4 - Évaluer l'urgence à résoudre l'incident","group":"Qualification","description":"### 🎯 Objectif\nÉvaluer l'urgence à résoudre l'incident\n\n### 📌 Actions\n- Un compte à privilèges Microsoft 365 ou Entra ID est-il confirmé compromis ?\n- Évaluer l'urgence à résoudre l'incident\n\n### ✅ Livrables\n- Urgence à résoudre l'incident.\n- Expliciter l'urgence dans les **activités** de cette tâche.","status":"Waiting","flag":false,"order":3,"mandatory":false,"extraData":{}},{"_id":"~82329712","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757497585316,"title":"Mesure 2 - Évaluer le périmètre de l'incident","group":"Qualification","description":"### 🎯 Objectif\nIdentifier les **comptes/roles** critiques, les incidents de sécurité liés.\n\n### 📌 Actions\n- Évaluer l'étendue de la compromission de l'environnement Azure\n  * Un compte à privilèges Microsoft 365 ou Entra ID est-il confirmé compromis ?\n  * Les données utilisateur (BAL, OneDrive, espaces Teams) sont-elles altérées voire détruites ?\n- Évaluer l'étendue de la compromission **hors** environnement Azure\n  * Y a-t-il des signalements liés à l’incident de sécurité qui proviennent de l’extérieur de l’organisation ?\n  * Est-ce que l’Active Directory (sur site) est considéré compromis ?\n  * Est-ce que des périphériques utilisateur (PC, ordiphone, tablette) sont considérés comme potentiellement compromis ?\n- Inventorier Global Admin, App Admin, Exchange Admin, etc.\n- Vérifier délégations, groupes PIM, accès permanents\n\n### ✅ Livrables\n- Périmètre cartographié (Azure / hors Azure).\n- Comptes impactés listés (admins, VIP, utilisateurs).\n- Tracer toutes informations utiles dans les **activités** de cette tâche","status":"Waiting","flag":false,"order":1,"mandatory":false,"extraData":{}},{"_id":"~123302072","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757497585309,"title":"Mesure 1 - Confirmer le type d’incident","group":"Qualification","description":"## 🎯 Objectif\n\nDéterminer le type d’incident en vérifiant rôles, sessions, journaux d’authentification, autorisations, flux de messagerie et politiques associées. \nSe référer à la fiche réflexe pour les procédures détaillées, informations complémentaires et schémas.\n👉 [Fiche réflexe](https://www.intercert-france.fr/wp-content/uploads/2025/06/fichereflexe-compromissiontenantazure-qualification.pdf)\n---\n\n## 📌 Actions\n\n- Établir si l’incident est une compromission de compte à privilèges Microsoft 365 ou Entra ID**\n\n  * **Vérifier les utilisateurs selon leurs rôles à privilèges Entra ID**\n    * S’assurer qu’il y a au moins **2** utilisateurs ayant le rôle **Administrateur global** pour la résilience et la récupération.\n    * Confirmer que tous ces comptes sont **légitimes** et **actifs**.\n    * Pour des comptes prestataires, vérifier leur légitimité via l’annuaire interne.\n    * Vérifier que **l’authentification multifacteur (MFA)** est activée pour tous.\n    * **Décision :** compromission de compte à privilèges confirmée ou non ?\n\n  * **Vérifier les sessions à privilèges**\n    * Analyser les **adresses IP** des connexions des comptes à privilèges sur plusieurs semaines (idéalement **6 mois**) depuis **Sign-in logs** dans **Microsoft Entra**.\n      * Si authentifications suspectes :\n        * Réinitialiser le **mot de passe** du compte concerné et **forcer la MFA** si absente.\n        * **Terminer toutes les sessions actives** et forcer la réauthentification.\n      * Exporter les journaux, trier par **Location**, puis **Status = Failure**, puis **date/heure**.\n    * **Décision :** compromission de compte à privilèges confirmée ou non ?\n\n  * **Vérifier les comptes à privilèges synchronisés entre Active Directory et Entra ID**\n    * S’assurer qu’aucun compte **on-premises AD** synchronisé ne possède de **rôles à privilèges Entra ID**.\n      * Le cas échéant, analyser leurs **Sign-in logs** sur plusieurs semaines (idéalement **6 mois**) et exporter pour tri (**Location**, **Status = Failure**, **date/heure**).\n    * Si possible, **désactiver** ces comptes ou, a minima, **réinitialiser** leur mot de passe et **forcer la MFA** via la console Azure MFA.\n    * **Décision :** compromission de compte à privilèges confirmée ou non ?\n\n  * **Traiter les alertes “risky users” et risques Entra ID**\n    * Traiter les **utilisateurs à risque** signalés dans **Microsoft Entra**.\n    * Traiter les **risques** affectant des comptes à privilèges.\n      * En cas de doute, **considérer le compte comme compromis**, noter les UPN, **réinitialiser le mot de passe** et **forcer la MFA**.\n    * Traiter les **authentifications à risque** signalées dans Entra ID pour les comptes à privilèges.\n    * **Décision :** compromission de compte à privilèges confirmée ou non ?\n\n---\n\n- Confirmer si l’incident est une compromission de compte utilisateur Microsoft 365**\n\n  * **Traitement des comptes déjà suspectés**\n    * Pour tout compte potentiellement compromis, vérifier s’il apparaît dans des bases publiques (ex. **Have I Been Pwned**).\n    * Traiter les **authentifications à risque** et les **risques** signalés par Entra ID.\n    * Traiter les **IP risquées** dans **Microsoft Entra Health**.\n    * Noter les UPN des comptes compromis, **réinitialiser les mots de passe** et **activer la MFA**.\n    * **Décision :** compromission de compte utilisateur confirmée ou non ?\n\n  * **Vérification des invités**\n    * Politique **Guest** configurée sur : *“Guest user access is restricted to properties and memberships of their own directory objects (most restrictive)”*.\n    * **Invitations d’invités** : *“Only users assigned to specific admin roles can invite guest users”*.\n    * Identifier les **comptes invités jamais authentifiés** et vérifier leur légitimité.\n    * **Décision :** compromission de compte utilisateur confirmée ou non ?\n\n  * **Vérifier les boîtes aux lettres Exchange Online**\n    * **Délégations** des BAL des comptes suspects : légitimes ou non ?\n    * BAL **cachées** de la **GAL**.\n    * **Règles de transfert externe** actives : légitimes ou non ?\n    * **SendAs delegates** : légitimes ou non ?\n    * **SendOnBehalfOf delegates** : légitimes ou non ?\n    * **Décision :** compromission de compte utilisateur confirmée ou non ?\n\n---\n\n- Confirmer si l’incident est un relais de contenu indésirable**\n\n  * **Vérifier la configuration anti-spam**\n    * Politique antispam du tenant : **Blocked Senders** et **Allowed Senders/Domains** légitimes.\n    * Politique **anti-usurpation** : entités autorisées à l’usurpation légitimes.\n    * **Décision :** relais de contenu indésirable confirmé ou non ?\n\n---\n\n- Confirmer si l’incident est une compromission d’application d’entreprise Azure Entra**\n\n  * **Traiter les anomalies sécurité associées aux applications**\n    * Applications enregistrées avec **Certificate credentials** ou **Client secret credentials**.\n    * Applications avec **permissions d’accès aux boîtes aux lettres** (*unified audit logs*).\n    * **Changements de propriétaire** d’application (*unified audit logs*).\n    * **Décision :** compromission d’application d’entreprise confirmée ou non ?\n\n  * **Vérifier une attaque de type “Illicit consent grant”**\n    * Suivre la procédure Microsoft **Detect and remediate illicit consent grants** et générer le **CSV**.\n    * Analyser le CSV :\n      * **ConsentType** = `AllPrincipals` : vérifier toute application **non-Microsoft**.\n      * **Permission** : identifier permissions **Read**, **Write** ou **All** et les valider.\n      * **Consents granted** par des utilisateurs **VIP/VOP** : investiguer en priorité.\n      * **ClientDisplayName** : rechercher noms suspects (fautes, blancs, noms d’outils offensifs).\n    * **Décision :** compromission d’application d’entreprise confirmée ou non ?\n\n---\n\n- Confirmer si l’incident est une fuite d’informations (incluant BEC)**\n\n  * **Vérifier les transferts automatiques**\n    * Consulter le **Auto forwarded message report**.\n    * Pour tout compte mentionné : vérifier la légitimité. À défaut, considérer le compte **potentiellement compromis**.\n      * Si l’utilisateur ne présente aucun signe de compromission, **suspecter un compte à privilèges Exchange Online** compromis.\n\n  * **Vérifier les règles de transport Exchange Online**\n    * **Exporter** les règles vers **XML** (cmdlets Exchange Online).\n    * Revoir **conditions** et **destinataires** pour légitimité.\n      * Les règles côté serveur permettent redirections, suppressions, copies, modifications d’en-têtes. Les attaquants en abusent.\n\n  * **Désactiver l’authentification des BAL partagées**\n    * Bonne pratique pour éviter des connexions directes non traçables à une identité unique.\n\n  * **Vérifier “RemoteDomain”**\n    * Absence de **caractères jokers**.\n    * Paramètres recommandés : **Delivery reports = autorisé**, **Non-delivery report = autorisé**, **Meeting forward notifications = bloqué**.\n    * Commande :\n      ```powershell\n      get-remotedomain *\n      ```\n\n  * **Vérifier l’absence de fournisseur externe de stockage autorisé**\n    * Commande :\n      ```powershell\n      Get-OwaMailboxPolicy -Identity <affected policy>\n      ```\n\n  * **Vérifier la politique d’espace de stockage tiers dans Microsoft Teams**\n    * S’assurer qu’aucune **exportation vers stockage externe illégitime** n’est autorisée.\n\n  * **Vérifier la politique d’autorisation des utilisateurs anonymes**\n    * S’assurer qu’elle ne permet pas d’**accès illégitimes**.\n\n  * **Conclure**\n    * **Décision :** fuite d’informations (incluant BEC) confirmée ou non ?\n    * Si besoin, se référer à la fiche réflexe InterCERT *Fuite d’information*.\n---\n\n## ✅ Livrables\n- Type d’incident confirmé, périmètre et justification documentés.\n- Comptes impactés listés, mesures appliquées : réinitialisation mot de passe, MFA forcée, sessions révoquées.\n- Exports et preuves conservés.\n- Traçabilité : toutes les actions renseignées dans les **activités** de cette tâche.","status":"Waiting","flag":false,"order":0,"mandatory":false,"extraData":{}},{"_id":"~123306168","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757497585322,"title":"Mesure 3 - Évaluer l'impact de l'incident","group":"Qualification","description":"### 🎯 Objectif\nDétecter **applications malveillantes** ou consentements abusifs.\n\n### 📌 Actions\n- Évaluer les impacts sur l'activité métier\n  * Est-ce que le service Microsoft Entra ID est toujours opérationnel ?\n  * Est-ce que le service Microsoft 365 Exchange Online est toujours opérationnel ?\n  * Est-ce que le service Microsoft 365 Teams est toujours opérationnel ?\n  * Est-ce que des informations sensibles ont été confirmés comment ayant fuité ?\n- Évaluer les impacts sur la reprise d'activité\n  * Est-ce que l’organisation dispose toujours d’un compte valide “administrateur global” Microsoft Entra ID ?\n  * En cas d’altération voire destruction de données utilisateur, existe-t-il des sauvegardes récentes des données (utilisateurs, EntraID M365) ?\n- Revue *Enterprise Apps*, *Service Principals*, *Graph permissions*\n\n### ✅ Livrables\n- Liste des activités vitales perturbées.\n- Liste des sauvegardes disponibles.\n- Tracer dans les **activités** de cette tâche les différentes informations.","status":"Waiting","flag":false,"order":2,"mandatory":false,"extraData":{}}],"extraData":{"pageTemplateHeaders":[]}}