{"_id":"~124153952","_type":"CaseTemplate","_createdBy":"thehive@thehive.local","_updatedBy":"thehive@thehive.local","_createdAt":1755071175799,"_updatedAt":1757497585330,"name":"Compromission d'un tenant Azure - Qualification","displayName":"","description":"# â˜ï¸ Compromission dâ€™un tenant Azure â€“ Qualification\n\n---\n\n## ğŸ¯ Usage\nConfirmer ou non une compromission liÃ©e Ã  :  \n- Comptes  \n- Applications  \n- Configuration  \n\nPuis estimer lâ€™impact et prÃ©parer lâ€™endiguement spÃ©cifique **M365 / Entra / Azure**.  \n\n---\n\n## âš™ï¸ PrÃ©requis\n\n- ğŸ‘¥ **Personnes et ressources nÃ©cessaires** :  \n  â†’ AccÃ¨s administration et supervision du SI.  \n  â†’ Identifiants dâ€™un compte â€œadministrateur globalâ€ Azure Entra ID.   \n  â†’ AccÃ¨s aux Ã©quipements de sÃ©curitÃ©.  \n  â†’ Ressources internes ou externes, infogÃ©rant mobilisable si besoin.  \n- ğŸ“ **Actions dÃ©jÃ  entreprises** : recenser les interventions passÃ©es et commencer Ã  les reporter dans la main courante.  \n\n\n---\n\n## ğŸ“Œ Objectifs\n\n1. Confirmer le type dâ€™incident  \n2. Ã‰valuer le pÃ©rimÃ¨tre de lâ€™incident  \n3. Mesurer lâ€™impact de lâ€™incident  \n4. DÃ©terminer lâ€™urgence de la rÃ©solution  \n\n---\n\n## ğŸ“„ Ressource\nğŸ‘‰ [Fiche rÃ©flexe complÃ¨te â€“ CERT-FR](https://www.intercert-france.fr/wp-content/uploads/2025/06/fichereflexe-compromissiontenantazure-qualification.pdf)","severity":2,"severityLabel":"MEDIUM","tags":["m365","tenant-azure","qualification","entra-id"],"flag":false,"customFields":[],"tasks":[{"_id":"~41316504","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757497585326,"title":"Mesure 4 - Ã‰valuer l'urgence Ã  rÃ©soudre l'incident","group":"Qualification","description":"### ğŸ¯ Objectif\nÃ‰valuer l'urgence Ã  rÃ©soudre l'incident\n\n### ğŸ“Œ Actions\n- Un compte Ã  privilÃ¨ges Microsoft 365 ou Entra ID est-il confirmÃ© compromis ?\n- Ã‰valuer l'urgence Ã  rÃ©soudre l'incident\n\n### âœ… Livrables\n- Urgence Ã  rÃ©soudre l'incident.\n- Expliciter l'urgence dans les **activitÃ©s** de cette tÃ¢che.","status":"Waiting","flag":false,"order":3,"mandatory":false,"extraData":{}},{"_id":"~82329712","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757497585316,"title":"Mesure 2 - Ã‰valuer le pÃ©rimÃ¨tre de l'incident","group":"Qualification","description":"### ğŸ¯ Objectif\nIdentifier les **comptes/roles** critiques, les incidents de sÃ©curitÃ© liÃ©s.\n\n### ğŸ“Œ Actions\n- Ã‰valuer l'Ã©tendue de la compromission de l'environnement Azure\n  * Un compte Ã  privilÃ¨ges Microsoft 365 ou Entra ID est-il confirmÃ© compromis ?\n  * Les donnÃ©es utilisateur (BAL, OneDrive, espaces Teams) sont-elles altÃ©rÃ©es voire dÃ©truites ?\n- Ã‰valuer l'Ã©tendue de la compromission **hors** environnement Azure\n  * Y a-t-il des signalements liÃ©s Ã  lâ€™incident de sÃ©curitÃ© qui proviennent de lâ€™extÃ©rieur de lâ€™organisation ?\n  * Est-ce que lâ€™Active Directory (sur site) est considÃ©rÃ© compromis ?\n  * Est-ce que des pÃ©riphÃ©riques utilisateur (PC, ordiphone, tablette) sont considÃ©rÃ©s comme potentiellement compromis ?\n- Inventorier Global Admin, App Admin, Exchange Admin, etc.\n- VÃ©rifier dÃ©lÃ©gations, groupes PIM, accÃ¨s permanents\n\n### âœ… Livrables\n- PÃ©rimÃ¨tre cartographiÃ© (Azure / hors Azure).\n- Comptes impactÃ©s listÃ©s (admins, VIP, utilisateurs).\n- Tracer toutes informations utiles dans les **activitÃ©s** de cette tÃ¢che","status":"Waiting","flag":false,"order":1,"mandatory":false,"extraData":{}},{"_id":"~123302072","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757497585309,"title":"Mesure 1 - Confirmer le type dâ€™incident","group":"Qualification","description":"## ğŸ¯ Objectif\n\nDÃ©terminer le type dâ€™incident en vÃ©rifiant rÃ´les, sessions, journaux dâ€™authentification, autorisations, flux de messagerie et politiques associÃ©es. \nSe rÃ©fÃ©rer Ã  la fiche rÃ©flexe pour les procÃ©dures dÃ©taillÃ©es, informations complÃ©mentaires et schÃ©mas.\nğŸ‘‰ [Fiche rÃ©flexe](https://www.intercert-france.fr/wp-content/uploads/2025/06/fichereflexe-compromissiontenantazure-qualification.pdf)\n---\n\n## ğŸ“Œ Actions\n\n- Ã‰tablir si lâ€™incident est une compromission de compte Ã  privilÃ¨ges Microsoft 365 ou Entra ID**\n\n  * **VÃ©rifier les utilisateurs selon leurs rÃ´les Ã  privilÃ¨ges Entra ID**\n    * Sâ€™assurer quâ€™il y a au moins **2** utilisateurs ayant le rÃ´le **Administrateur global** pour la rÃ©silience et la rÃ©cupÃ©ration.\n    * Confirmer que tous ces comptes sont **lÃ©gitimes** et **actifs**.\n    * Pour des comptes prestataires, vÃ©rifier leur lÃ©gitimitÃ© via lâ€™annuaire interne.\n    * VÃ©rifier que **lâ€™authentification multifacteur (MFA)** est activÃ©e pour tous.\n    * **DÃ©cision :** compromission de compte Ã  privilÃ¨ges confirmÃ©e ou non ?\n\n  * **VÃ©rifier les sessions Ã  privilÃ¨ges**\n    * Analyser les **adresses IP** des connexions des comptes Ã  privilÃ¨ges sur plusieurs semaines (idÃ©alement **6 mois**) depuis **Sign-in logs** dans **Microsoft Entra**.\n      * Si authentifications suspectes :\n        * RÃ©initialiser le **mot de passe** du compte concernÃ© et **forcer la MFA** si absente.\n        * **Terminer toutes les sessions actives** et forcer la rÃ©authentification.\n      * Exporter les journaux, trier par **Location**, puis **Status = Failure**, puis **date/heure**.\n    * **DÃ©cision :** compromission de compte Ã  privilÃ¨ges confirmÃ©e ou non ?\n\n  * **VÃ©rifier les comptes Ã  privilÃ¨ges synchronisÃ©s entre Active Directory et Entra ID**\n    * Sâ€™assurer quâ€™aucun compte **on-premises AD** synchronisÃ© ne possÃ¨de de **rÃ´les Ã  privilÃ¨ges Entra ID**.\n      * Le cas Ã©chÃ©ant, analyser leurs **Sign-in logs** sur plusieurs semaines (idÃ©alement **6 mois**) et exporter pour tri (**Location**, **Status = Failure**, **date/heure**).\n    * Si possible, **dÃ©sactiver** ces comptes ou, a minima, **rÃ©initialiser** leur mot de passe et **forcer la MFA** via la console Azure MFA.\n    * **DÃ©cision :** compromission de compte Ã  privilÃ¨ges confirmÃ©e ou non ?\n\n  * **Traiter les alertes â€œrisky usersâ€ et risques Entra ID**\n    * Traiter les **utilisateurs Ã  risque** signalÃ©s dans **Microsoft Entra**.\n    * Traiter les **risques** affectant des comptes Ã  privilÃ¨ges.\n      * En cas de doute, **considÃ©rer le compte comme compromis**, noter les UPN, **rÃ©initialiser le mot de passe** et **forcer la MFA**.\n    * Traiter les **authentifications Ã  risque** signalÃ©es dans Entra ID pour les comptes Ã  privilÃ¨ges.\n    * **DÃ©cision :** compromission de compte Ã  privilÃ¨ges confirmÃ©e ou non ?\n\n---\n\n- Confirmer si lâ€™incident est une compromission de compte utilisateur Microsoft 365**\n\n  * **Traitement des comptes dÃ©jÃ  suspectÃ©s**\n    * Pour tout compte potentiellement compromis, vÃ©rifier sâ€™il apparaÃ®t dans des bases publiques (ex. **Have I Been Pwned**).\n    * Traiter les **authentifications Ã  risque** et les **risques** signalÃ©s par Entra ID.\n    * Traiter les **IP risquÃ©es** dans **Microsoft Entra Health**.\n    * Noter les UPN des comptes compromis, **rÃ©initialiser les mots de passe** et **activer la MFA**.\n    * **DÃ©cision :** compromission de compte utilisateur confirmÃ©e ou non ?\n\n  * **VÃ©rification des invitÃ©s**\n    * Politique **Guest** configurÃ©e sur : *â€œGuest user access is restricted to properties and memberships of their own directory objects (most restrictive)â€*.\n    * **Invitations dâ€™invitÃ©s** : *â€œOnly users assigned to specific admin roles can invite guest usersâ€*.\n    * Identifier les **comptes invitÃ©s jamais authentifiÃ©s** et vÃ©rifier leur lÃ©gitimitÃ©.\n    * **DÃ©cision :** compromission de compte utilisateur confirmÃ©e ou non ?\n\n  * **VÃ©rifier les boÃ®tes aux lettres Exchange Online**\n    * **DÃ©lÃ©gations** des BAL des comptes suspects : lÃ©gitimes ou non ?\n    * BAL **cachÃ©es** de la **GAL**.\n    * **RÃ¨gles de transfert externe** actives : lÃ©gitimes ou non ?\n    * **SendAs delegates** : lÃ©gitimes ou non ?\n    * **SendOnBehalfOf delegates** : lÃ©gitimes ou non ?\n    * **DÃ©cision :** compromission de compte utilisateur confirmÃ©e ou non ?\n\n---\n\n- Confirmer si lâ€™incident est un relais de contenu indÃ©sirable**\n\n  * **VÃ©rifier la configuration anti-spam**\n    * Politique antispam du tenant : **Blocked Senders** et **Allowed Senders/Domains** lÃ©gitimes.\n    * Politique **anti-usurpation** : entitÃ©s autorisÃ©es Ã  lâ€™usurpation lÃ©gitimes.\n    * **DÃ©cision :** relais de contenu indÃ©sirable confirmÃ© ou non ?\n\n---\n\n- Confirmer si lâ€™incident est une compromission dâ€™application dâ€™entreprise Azure Entra**\n\n  * **Traiter les anomalies sÃ©curitÃ© associÃ©es aux applications**\n    * Applications enregistrÃ©es avec **Certificate credentials** ou **Client secret credentials**.\n    * Applications avec **permissions dâ€™accÃ¨s aux boÃ®tes aux lettres** (*unified audit logs*).\n    * **Changements de propriÃ©taire** dâ€™application (*unified audit logs*).\n    * **DÃ©cision :** compromission dâ€™application dâ€™entreprise confirmÃ©e ou non ?\n\n  * **VÃ©rifier une attaque de type â€œIllicit consent grantâ€**\n    * Suivre la procÃ©dure Microsoft **Detect and remediate illicit consent grants** et gÃ©nÃ©rer le **CSV**.\n    * Analyser le CSV :\n      * **ConsentType** = `AllPrincipals` : vÃ©rifier toute application **non-Microsoft**.\n      * **Permission** : identifier permissions **Read**, **Write** ou **All** et les valider.\n      * **Consents granted** par des utilisateurs **VIP/VOP** : investiguer en prioritÃ©.\n      * **ClientDisplayName** : rechercher noms suspects (fautes, blancs, noms dâ€™outils offensifs).\n    * **DÃ©cision :** compromission dâ€™application dâ€™entreprise confirmÃ©e ou non ?\n\n---\n\n- Confirmer si lâ€™incident est une fuite dâ€™informations (incluant BEC)**\n\n  * **VÃ©rifier les transferts automatiques**\n    * Consulter le **Auto forwarded message report**.\n    * Pour tout compte mentionnÃ© : vÃ©rifier la lÃ©gitimitÃ©. Ã€ dÃ©faut, considÃ©rer le compte **potentiellement compromis**.\n      * Si lâ€™utilisateur ne prÃ©sente aucun signe de compromission, **suspecter un compte Ã  privilÃ¨ges Exchange Online** compromis.\n\n  * **VÃ©rifier les rÃ¨gles de transport Exchange Online**\n    * **Exporter** les rÃ¨gles vers **XML** (cmdlets Exchange Online).\n    * Revoir **conditions** et **destinataires** pour lÃ©gitimitÃ©.\n      * Les rÃ¨gles cÃ´tÃ© serveur permettent redirections, suppressions, copies, modifications dâ€™en-tÃªtes. Les attaquants en abusent.\n\n  * **DÃ©sactiver lâ€™authentification des BAL partagÃ©es**\n    * Bonne pratique pour Ã©viter des connexions directes non traÃ§ables Ã  une identitÃ© unique.\n\n  * **VÃ©rifier â€œRemoteDomainâ€**\n    * Absence de **caractÃ¨res jokers**.\n    * ParamÃ¨tres recommandÃ©s : **Delivery reports = autorisÃ©**, **Non-delivery report = autorisÃ©**, **Meeting forward notifications = bloquÃ©**.\n    * Commande :\n      ```powershell\n      get-remotedomain *\n      ```\n\n  * **VÃ©rifier lâ€™absence de fournisseur externe de stockage autorisÃ©**\n    * Commande :\n      ```powershell\n      Get-OwaMailboxPolicy -Identity <affected policy>\n      ```\n\n  * **VÃ©rifier la politique dâ€™espace de stockage tiers dans Microsoft Teams**\n    * Sâ€™assurer quâ€™aucune **exportation vers stockage externe illÃ©gitime** nâ€™est autorisÃ©e.\n\n  * **VÃ©rifier la politique dâ€™autorisation des utilisateurs anonymes**\n    * Sâ€™assurer quâ€™elle ne permet pas dâ€™**accÃ¨s illÃ©gitimes**.\n\n  * **Conclure**\n    * **DÃ©cision :** fuite dâ€™informations (incluant BEC) confirmÃ©e ou non ?\n    * Si besoin, se rÃ©fÃ©rer Ã  la fiche rÃ©flexe InterCERT *Fuite dâ€™information*.\n---\n\n## âœ… Livrables\n- Type dâ€™incident confirmÃ©, pÃ©rimÃ¨tre et justification documentÃ©s.\n- Comptes impactÃ©s listÃ©s, mesures appliquÃ©es : rÃ©initialisation mot de passe, MFA forcÃ©e, sessions rÃ©voquÃ©es.\n- Exports et preuves conservÃ©s.\n- TraÃ§abilitÃ© : toutes les actions renseignÃ©es dans les **activitÃ©s** de cette tÃ¢che.","status":"Waiting","flag":false,"order":0,"mandatory":false,"extraData":{}},{"_id":"~123306168","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757497585322,"title":"Mesure 3 - Ã‰valuer l'impact de l'incident","group":"Qualification","description":"### ğŸ¯ Objectif\nDÃ©tecter **applications malveillantes** ou consentements abusifs.\n\n### ğŸ“Œ Actions\n- Ã‰valuer les impacts sur l'activitÃ© mÃ©tier\n  * Est-ce que le service Microsoft Entra ID est toujours opÃ©rationnel ?\n  * Est-ce que le service Microsoft 365 Exchange Online est toujours opÃ©rationnel ?\n  * Est-ce que le service Microsoft 365 Teams est toujours opÃ©rationnel ?\n  * Est-ce que des informations sensibles ont Ã©tÃ© confirmÃ©s comment ayant fuitÃ© ?\n- Ã‰valuer les impacts sur la reprise d'activitÃ©\n  * Est-ce que lâ€™organisation dispose toujours dâ€™un compte valide â€œadministrateur globalâ€ Microsoft Entra ID ?\n  * En cas dâ€™altÃ©ration voire destruction de donnÃ©es utilisateur, existe-t-il des sauvegardes rÃ©centes des donnÃ©es (utilisateurs, EntraID M365) ?\n- Revue *Enterprise Apps*, *Service Principals*, *Graph permissions*\n\n### âœ… Livrables\n- Liste des activitÃ©s vitales perturbÃ©es.\n- Liste des sauvegardes disponibles.\n- Tracer dans les **activitÃ©s** de cette tÃ¢che les diffÃ©rentes informations.","status":"Waiting","flag":false,"order":2,"mandatory":false,"extraData":{}}],"extraData":{"pageTemplateHeaders":[]}}