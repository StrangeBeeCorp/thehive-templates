{"_id":"~41656360","_type":"CaseTemplate","_createdBy":"thehive@thehive.local","_updatedBy":"thehive@thehive.local","_createdAt":1755071180465,"_updatedAt":1757431653308,"name":"Compromission d'un tenant Azure - Endiguement","displayName":"","description":"# ‚òÅÔ∏è Compromission d‚Äôun tenant Azure ‚Äì Endiguement\n---\n\n## üéØ Usage\nReprendre rapidement le contr√¥le du tenant Azure compromis en :  \n- Supprimant les acc√®s et applications malveillantes  \n- Assainissant les comptes, configurations et workloads  \n- D√©ployant des mesures durables pour pr√©venir toute r√©intrusion \n\n---\n\n## ‚öôÔ∏è Pr√©requis avant d√©marrage\n- üë• Personnes disponibles avec droits d‚Äôadministration sur le tenant Azure  \n- üîë Compte admin valide et non compromis (id√©alement Administrateur g√©n√©ral)  \n- üë• Support technique mobilisable rapidement si SI infog√©r√©   \n\n---\n\n## üìå Objectif\nD√©tailler les mesures d‚Äôendiguement et actions possibles selon le type de compromission :  \n\n- **Cas 1** : Compromission d‚Äôun compte Microsoft 365 ou Entra ID  \n- **Cas 2** : Compromission d‚Äôune application d‚Äôentreprise Microsoft Azure Entra  \n- **Cas 3** : Compromission d‚Äôune ressource Azure  \n- **Cas 4** : Relai de contenu ind√©sirable  \n- **Cas 5** : Fuite d‚Äôinformations  \n\n---\n\n## üìÑ Ressource\nüëâ [Fiche r√©flexe compl√®te ‚Äì INTERCERT-FR](https://www.intercert-france.fr/wp-content/uploads/2025/06/fichereflexe-compromissiontenantazure-endiguement.pdf)","severity":2,"severityLabel":"MEDIUM","tags":["m365","tenant-azure","endiguement","entra-id"],"flag":false,"customFields":[],"tasks":[{"_id":"~82129104","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757431528052,"title":"Cas 1 : Compromission d'un compte Microsoft 365 ou Entra ID","group":"Endiguement","description":"## üéØ Objectif\n\nReprendre le contr√¥le du compte compromis et emp√™cher toute r√©utilisation par l‚Äôattaquant.\n\n---\n\n## üìå Actions\n\n*  R√©initialiser le mot de passe des comptes\n    * Se connecter √† [Entra ID](https://entra.microsoft.com)\n    * Aller sur **Utilisateurs > Utilisateurs actifs**\n    * S√©lectionner le compte ‚Üí **R√©initialiser le mot de passe** (2 fois pour obtenir un mot de passe temporaire)\n---\n*  R√©voquer les sessions actives\n    * [Entra ID](https://entra.microsoft.com) ‚Üí **Utilisateurs actifs** ‚Üí S√©lectionner le compte ‚Üí **R√©voquer les sessions**\n---\n*  D√©sactiver le compte si n√©cessaire\n    * [Entra ID](https://entra.microsoft.com) ‚Üí **Utilisateurs actifs** ‚Üí S√©lectionner le compte ‚Üí **Modifier les propri√©t√©s**\n    * Onglet **Param√®tres** ‚Üí d√©cocher *Compte activ√©* ‚Üí **Enregistrer**\n---\n*  Exiger une r√©inscription MFA\n    * [Entra ID](https://entra.microsoft.com) ‚Üí **Utilisateurs actifs** ‚Üí S√©lectionner le compte ‚Üí **M√©thodes d‚Äôauthentification**\n    * Cliquer sur **Exiger une r√©inscription MFA** ‚Üí **OK**\n---\n*  Durcir la strat√©gie d‚Äôacc√®s conditionnel\n    * Bloquer les adresses IP malveillantes / filtrage g√©ographique\n    * [Entra ID](https://entra.microsoft.com) ‚Üí **Protection > Acc√®s conditionnel** ‚Üí Cr√©er une nouvelle strat√©gie\n---\n*  R√©voquer les r√¥les Entra ID ill√©gitimes\n    * [Entra ID](https://entra.microsoft.com) ‚Üí **Utilisateurs actifs** ‚Üí S√©lectionner le compte ‚Üí **R√¥les affect√©s**\n    * Supprimer les r√¥les non l√©gitimes\n---\n## ‚úÖ Livrables\n\n* Compte compromis s√©curis√© (mot de passe r√©initialis√©, MFA r√©inscrit, sessions r√©voqu√©es)\n* Acc√®s conditionnels et r√¥les r√©vis√©s\n* Tracer dans les **activit√©s** de cette t√¢che les actions r√©alis√©es.","status":"Waiting","flag":false,"order":0,"mandatory":false,"extraData":{}},{"_id":"~82133200","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757431528075,"title":"Cas 5 : Fuite d'informations","group":"Endiguement","description":"## üéØ Objectif\n\nSupprimer toutes les persistances et m√©canismes de compromission dans Exchange Online (r√®gles, d√©l√©gations, protocoles anciens, extensions interdites) afin de bloquer l‚Äôexfiltration de donn√©es, s√©curiser les bo√Ætes aux lettres et restaurer une configuration saine.\n\n---\n\n## üìå Actions\n\n\n* Supprimer les r√®gles de transfert ill√©gitimes\n\n  * Ouvrir une console PowerShell.\n  L‚Äôinstallation du module PowerShell **ExchangeOnlineManagement** est un pr√©requis et s‚Äôinstalle avec :\n\n  ```powershell\n  Install-Module ExchangeOnlineManagement -Scope CurrentUser\n  ```\n  * Se connecter √† Exchange Online PowerShell (remplacer `<admin@votredomaine.com>`) :\n\n  ```powershell\n  Connect-ExchangeOnline -UserPrincipalName <admin@votredomaine.com> -ShowProgress $true\n  ```\n  * Lister les r√®gles de bo√Æte de r√©ception d‚Äôun utilisateur (remplacer `<utilisateur@votredomaine.com>`) :\n\n  ```powershell\n  Get-InboxRule -Mailbox \"<utilisateur@votredomaine.com>\"\n  ```\n  * Supprimer les r√®gles ill√©gitimes (remplacer `<NomDeLaR√®gle>`) :\n\n  ```powershell\n  Remove-InboxRule -Mailbox \"<utilisateur@votredomaine.com>\" -Identity \"<NomDeLaR√®gle>\"\n  ```\n\n\n---\n\n* Supprimer les r√®gles de transport ill√©gitimes\n\n  * Se connecter au **Centre d‚Äôadministration Exchange** :\n   [https://admin.exchange.microsoft.com/#/transportrules](https://admin.exchange.microsoft.com/#/transportrules)\n  * Identifier toute r√®gle suspecte (redirection externe, copie cach√©e).\n  * D√©sactiver ou supprimer les r√®gles ill√©gitimes.\n  * Restaurer une configuration saine si un export de r√®gles existe.\n\n\n\n---\n\n* D√©sactiver l‚Äôauthentification directe sur les bo√Ætes aux lettres partag√©es (via IMAP, POP, SMTP Auth, MAPI, OWA)\n\n  * Identifier toutes les bo√Ætes aux lettres partag√©es avec une authentification directe activ√©e.\n  * Ouvrir une console PowerShell.\n  L‚Äôinstallation du module PowerShell **ExchangeOnlineManagement** est un pr√©requis :\n\n  ```powershell\n  Install-Module ExchangeOnlineManagement -Scope CurrentUser\n  ```\n  * Lister les bo√Ætes aux lettres partag√©es avec authentification directe activ√©e :\n\n  ```powershell\n  Get-Mailbox -RecipientTypeDetails SharedMailbox | Get-CASMailbox\n  ```\n  * D√©sactiver les acc√®s directs (IMAP, POP, MAPI, OWA) si activ√©s (remplacer `<BAL>`) :\n\n  ```powershell\n  Set-CASMailbox -Identity \"<BAL>\" -MAPIEnabled $false\n  ```\n  * Conserver uniquement l‚Äôacc√®s via d√©l√©gation sur un compte utilisateur authentifi√©.\n\n\n---\n\n* D√©sactiver les protocoles historiques (IMAP, POP, SMTP Auth)\n\n  * Ouvrir une console PowerShell.\n  Pr√©-requis : installation du module **ExchangeOnlineManagement** :\n\n  ```powershell\n  Install-Module ExchangeOnlineManagement -Scope CurrentUser\n  ```\n  * V√©rifier les protocoles autoris√©s au niveau du tenant et par utilisateur :\n\n  ```powershell\n  Get-CASMailbox | Where-Object {$_.PopEnabled -eq $true -or $_.ImapEnabled -eq $true}\n  ```\n  * D√©sactiver les protocoles obsol√®tes sauf n√©cessit√© m√©tier (remplacer `<utilisateur>`) :\n\n  ```powershell\n  Set-CASMailbox -Identity \"<utilisateur>\" -PopEnabled $false -ImapEnabled $false -SmtpClientAuthenticationDisabled $true\n  ```\n  * Surveiller si certains comptes tentent encore d‚Äôutiliser ces protocoles (alerte Defender).\n\n\n\n---\n\n* Supprimer les extensions de pi√®ces jointes non autoris√©es\n\n  * Ouvrir une console PowerShell.\n  Pr√©-requis : installation du module **ExchangeOnlineManagement** :\n\n  ```powershell\n  Install-Module ExchangeOnlineManagement -Scope CurrentUser\n  ```\n  * Se connecter √† Exchange Online PowerShell (remplacer `<admin@votredomaine.com>`) :\n\n  ```powershell\n  Connect-ExchangeOnline -UserPrincipalName <admin@votredomaine.com> -ShowProgress $true\n  ```\n  * Modifier les politiques anti-malware d‚ÄôExchange Online. Interdire par ex. `.exe`, `.js`, `.vbs`, `.scr`.\n\n  ```powershell\n  New-TransportRule -Name \"Bloquer les pi√®ces jointes ex√©cutables\" -AttachmentExtensionMatchesWords \"exe\",\"js\",\"vbs\",\"scr\" -RejectMessageReasonText \"Les fichiers ex√©cutables sont bloqu√©s pour des raisons de s√©curit√©.\" -Enabled $true\n  ```\n  * Ajouter des r√®gles suppl√©mentaires pour bloquer les extensions sp√©cifiques utilis√©es lors de l‚Äôincident.\n  * D√©finir et surveiller les alertes pour identifier un compte compromis non encore d√©tect√©.\n\n\n\n---\n\n* Supprimer les d√©l√©gations ill√©gitimes d‚Äôune bo√Æte de messagerie\n\n  * Se connecter au **Centre d‚Äôadministration Exchange** :\n   [https://admin.cloud.microsoft/exchange#/mailboxes](https://admin.cloud.microsoft/exchange#/mailboxes)\n  * S√©lectionner le compte de bo√Æte de messagerie.\n  * Supprimer les d√©l√©gations ill√©gitimes pour :\n\n    * Envoyer en tant que\n    * Envoyer de la part de\n    * Lecture et gestion (acc√®s total)\n  * Se connecter √† Exchange Online PowerShell (remplacer `<admin@votredomaine.com>`) :\n\n  ```powershell\n  Connect-ExchangeOnline -UserPrincipalName <admin@votredomaine.com> -ShowProgress $true\n  ```\n  * V√©rifier les d√©l√©gations restantes et restaurer une configuration l√©gitime si n√©cessaire.\n\n---\n\n## ‚úÖ Livrables\n* Adresses cibles ajout√©es comme observables.\n* Liste des r√®gles d√©sactiv√©es/supprim√©es.\n* Liste des BAL s√©curis√©es.\n* Liste des extensions bloqu√©es.\n* Liste des d√©l√©gations supprim√©es.\n* Tracer dans les **activit√©s** de cette t√¢che les actions r√©alis√©es.","status":"Waiting","flag":false,"order":4,"mandatory":false,"extraData":{}},{"_id":"~123105320","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757431528063,"title":"Cas 3 : Compromission d'une ressource Azure","group":"Endiguement","description":"## üéØ Objectif\n\nIsoler les ressources Azure compromises et r√©voquer les identifiants associ√©s afin de stopper l‚Äôactivit√© malveillante, limiter la propagation et s√©curiser la continuit√© des services.\n\n---\n\n## üìå Actions \n\n* Identifier la ressource Azure compromise et appliquer une isolation adapt√©e :\n\n  * **VM** : d√©connecter l‚Äôinterface r√©seau (NIC), appliquer un NSG restrictif ou mettre la VM en pause.\n  * **PaaS (App Service, Azure Function)** : d√©sactiver temporairement le service, bloquer l‚Äôacc√®s externe par restriction IP.\n  * **Storage Account** : d√©sactiver l‚Äôacc√®s public, r√©g√©n√©rer les *storage keys*, appliquer un firewall r√©seau restrictif.\n* Confirmer l‚Äôefficacit√© de l‚Äôisolation via absence de nouvelles alertes (trafic bloqu√©, plus d‚Äôalertes EDR/AV, Microsoft Defender for Cloud).\n\n\n---\n\n* R√©voquer les identifiants compromis li√©s aux ressources Azure\n\n  * R√©voquer et renouveler :\n\n    * Cl√©s/secrets d‚Äô**Azure Key Vault**.\n    * Tokens d‚Äôacc√®s aux **API ou services externes**.\n    * Mots de passe des comptes techniques locaux (VM, services).\n  * Mettre √† jour les configurations applicatives pour pointer vers les nouveaux identifiants s√©curis√©s.\n  * V√©rifier que les anciens identifiants ne sont plus utilisables (tests pratiques + analyse des logs).\n\n---\n\n## ‚úÖ **Livrables**\n\n* Identifiants compromis r√©voqu√©s, nouveaux actifs en production.\n* Anciens identifiants ajout√©s comme observables pour suivi et tra√ßabilit√©.\n* Ressources compromises isol√©es et trafic malveillant bloqu√©.\n* Journaux/alertes avant-apr√®s et captures de configuration ajout√©s comme observables.\n* Tracer dans les **activit√©s** de cette t√¢che les actions r√©alis√©es.","status":"Waiting","flag":false,"order":2,"mandatory":false,"extraData":{}},{"_id":"~164081688","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757431528067,"title":"Cas 4 : Relai de contenu ind√©sirable","group":"Endiguement","description":"## üéØ Objectif\n\nRestaurer et renforcer les configurations de s√©curit√© anti-spam et anti-spoofing compromises afin d‚Äôemp√™cher la poursuite des abus, bloquer les menaces par email et limiter le risque de r√©cidive.\n\n---\n\n### üìå Actions\n\n* Restaurer la configuration anti-spam compromise\n\n  * Se connecter au portail de gestion des listes d‚Äôautorisation et de blocage :\n   [https://security.microsoft.com/tenantAllowBlockList](https://security.microsoft.com/tenantAllowBlockList)\n  * Supprimer les **domaines** et **adresses ill√©gitimes** qui auraient √©t√© ajout√©s par l‚Äôattaquant.\n\n---\n\n* Renforcer la configuration anti-spam pour √©viter une r√©cidive\n\n  * Appliquer une politique plus stricte pour les **utilisateurs √† risque** (VIP, comptes techniques, direction).\n  * Se connecter au portail des politiques de s√©curit√© pr√©configur√©es :\n   [https://security.microsoft.com/presetSecurityPolicies](https://security.microsoft.com/presetSecurityPolicies)\n\n  * Cr√©er une strat√©gie pour **Protection stricte**.\n  * Activer la **quarantaine syst√©matique** pour les emails suspects.\n  * Se connecter √† la configuration anti-spam :\n   [https://security.microsoft.com/antispam](https://security.microsoft.com/antispam)\n\n  * Activer les **notifications d‚Äôadministrateur** pour les envois ou r√©ceptions massifs suspects.\n\n---\n\n* Restaurer la politique anti-spoofing compromise\n\n  * Se connecter √† la gestion anti-hame√ßonnage :\n   [https://security.microsoft.com/antiphishing](https://security.microsoft.com/antiphishing)\n  * V√©rifier les param√®tres de la **strat√©gie anti-hame√ßonnage** dans Microsoft 365 Defender.\n  * S√©lectionner la **r√®gle activ√©e** et r√©viser toutes les entr√©es suivantes :\n\n    * G√©rer `[x] exp√©diteurs`\n    * G√©rer `[x] domaine(s) personnalis√©(s)`\n    * G√©rer `[x] exp√©diteur(s) et domaine(s) approuv√©(s)`\n---\n\n‚úÖ **Livrables**\n\n* Liste des domaines/adresses supprim√©es.\n* Strat√©gies anti-spam renforc√©es appliqu√©es.\n* Politique anti-spoofing revue et restaur√©e.\n* Domaines et exp√©diteurs malveillants ajout√©s comme observables.\n* Tracer dans les **activit√©s** de cette t√¢che les actions r√©alis√©es.","status":"Waiting","flag":false,"order":3,"mandatory":false,"extraData":{}},{"_id":"~287002688","_type":"Task","_createdBy":"thehive@thehive.local","_createdAt":1757431528058,"title":"Cas 2 : Compromission d'application d'entreprise Microsoft Azure Entra","group":"Endiguement","description":"üéØ Objectif\n\nIsoler et s√©curiser les applications compromises ou malveillantes dans Entra ID.\n\n---\n\n## üìå Actions\n\n\n* D√©sactiver la connexion vers l'application compromise ou malveillante\n\n    * √âvaluer au pr√©alable l‚Äôimpact m√©tier vs le risque s√©curit√©.\n    * Se connecter √† **[https://entra.microsoft.com](https://entra.microsoft.com)**.\n    * Aller dans **Applications > Applications d‚Äôentreprise**.\n      * S√©lectionner l‚Äôapplication compromise (supprimer les filtres si besoin).\n    * D√©sactiver l'application: dans **Propri√©t√©s**, d√©finir *Activ√©e pour la connexion des utilisateurs ?* sur **Non**.\n\n      * Cas application malveillante : supprimer l‚Äôapplication apr√®s investigation.\n      * Cas application compromise : recr√©er/configurer une nouvelle application s√©curis√©e, puis supprimer l‚Äôancienne apr√®s investigation.\n    * Explorer les options de renforcement :\n\n      * Acc√®s conditionnel pour identit√©s de service.\n      * Politiques de risque applicatif.\n\n\n---\n\n* R√©vision des acc√®s d'une application compromise non d√©sactiv√©e\n\n    * Se connecter √† **[https://entra.microsoft.com](https://entra.microsoft.com)** > Applications d‚Äôentreprise.\n    * S√©lectionner l‚Äôapplication compromise > **Autorisations** > **R√©vision des autorisations**.\n    * S√©lectionner \"**Cette application est malveillante et je suis compromis**.\"\n    * Ex√©cuter les 3 scripts PowerShell propos√©s pour nettoyer rapidement la configuration de l'authentification de l'application (apr√®s l'installation du module Powershell \"Microsoft.Graph\" `Install-Module Microsoft.Graph`) pour :\n\n      1. Supprimer les utilisateurs affect√©s.\n      2. Invalider les jetons d‚Äôactualisation.\n      3. R√©voquer toutes les autorisations.\n    * Dans **Propri√©t√©s** : exiger l‚Äôaffectation d‚Äôun utilisateur.\n    * Dans **Autorisations** : r√©voquer les consentements ill√©gitimes (admin et utilisateur).\n    * Dans **Utilisateurs et groupes** : supprimer les utilisateurs affect√©s ill√©gitimes.\n\n\n---\n\n* R√©initialiser certificats et secrets d'une application compromise qui n'est pas d√©sactiv√©e\n\n    * Se connecter √† **[https://entra.microsoft.com](https://entra.microsoft.com)** > **Applications** > **Inscriptions d‚Äôapplications** > **Certificats & Secrets**.\n    * Supprimer certificats et secrets compromis.\n    * Recr√©er uniquement des certificats/secrets l√©gitimes si n√©cessaire.\n\n\n---\n\n* Supprimer r√¥les Entra ID ill√©gitimes d'une application compromise\n    * Se connecter √† **[https://entra.microsoft.com](https://entra.microsoft.com)** > **R√¥les et administrateurs**.\n    * T√©l√©charger les attributions pour identifier plus vite les r√¥les ill√©gitimes.\n    * Retirer l‚Äôapplication des r√¥les compromis.\n\n---\n\n* Restaurer la configuration l√©gitime des r√¥les & administrateurs\n    * Identifier les modifications r√©centes suspectes.\n    * Se connecter √† **[https://entra.microsoft.com](https://entra.microsoft.com)** > **Applications d‚Äôentreprise** > **R√¥les et administrateurs**.\n    * Restaurer la configuration initiale l√©gitime.\n\n---\n\n* Restaurer le propri√©taire l√©gitime de l'application compromise\n    * Identifier les changements suspects sur propri√©taires/admins.\n    * Se connecter √† **[https://entra.microsoft.com](https://entra.microsoft.com)** > Inscriptions d‚Äôapplications > s√©lectionner l‚Äôapplication.\n    * R√©attribuer le propri√©taire l√©gitime.\n    * Avertir imm√©diatement le propri√©taire restaur√© pour qu‚Äôil v√©rifie les permissions.\n\n---\n\n* Imposer le consentement explicite d‚Äôun administrateur\n    * Se connecter √† **[https://entra.microsoft.com](https://entra.microsoft.com)** > **Applications d‚Äôentreprise** > **Consentement et autorisations**.\n    * Dans **Param√®tres du consentement utilisateur** :\n      * Autoriser uniquement pour applications d‚Äô√©diteurs v√©rifi√©s et impact faible.\n  * Dans **Param√®tres du consentement administrateur** :\n    * Activer \"*Les utilisateurs peuvent demander le consentement d‚Äôadministrateur*\".\n    * D√©finir les groupes ou r√¥les autoris√©s √† r√©viser les demandes.\n    * Enregistrer les modifications.\n\n\n----\n‚úÖ**Livrables**\n- Application compromise isol√©e/supprim√©e\n- Certificats et secrets compromis r√©voqu√©s\n- Tracer dans les **activit√©s** de cette t√¢che l'ensemble des actions r√©alis√©es.","status":"Waiting","flag":false,"order":1,"mandatory":false,"extraData":{}}],"extraData":{"pageTemplateHeaders":[]}}