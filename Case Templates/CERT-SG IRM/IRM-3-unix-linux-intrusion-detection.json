{"_id":"~2539585536","_type":"CaseTemplate","_createdBy":"florian@strangebee.com","_updatedBy":"florian@strangebee.com","_createdAt":1652086048511,"_updatedAt":1652106288130,"name":"Unix/Linux Intrusion Detection","displayName":"Unix/Linux Intrusion Detection (CERT-SG IRM3)","titlePrefix":"","description":"Unix/Linux Intrusion Detection","severity":3,"tags":[],"flag":false,"tlp":2,"pap":2,"customFields":[],"tasks":[{"_id":"~1966141672","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154545,"title":"File hashes","group":"Identification","description":"Verify all MD5 hashes of your binaries in /bin, /sbin, /usr/bin, /usr/sbin or any other related binary storing place. (use AIDE or such tool)\n\n**WARNING: this operation will probably change all file timestamps. This should only be done after all other investigations are done and you feel like you can alter these data.**\n\n- On systems with RPM installed, use:\n\n```\n# rpm –Va | sort\n```\n\n- On some Linux, a script named check-packages can be used. On Solaris: \n\n```\n# pkg_chk –vn\n```\n\n- On Debian: \n\n```\ndebsums –ac\n```\n\n- On Openbsd (not really this but a way): \n\n```\npkg_delete -vnx\n```","status":"Waiting","flag":false,"order":8,"extraData":{}},{"_id":"~1966145768","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154546,"title":"Backup","group":"Containment","description":"Backup all important data from the compromised machine, if possible using a bit-by-bit physical copy of the whole hard disk on an external support. Also make a copy of the memory (RAM) of the system, which will be investigated if necessary.\n\nIf the machine is not considered critical for the company and can be disconnected, shut the machine down the hard way, removing its power plug. If it is a laptop with a battery on, just push the “off” button for some seconds until the computer switches off.\n\nOffline investigations should be started right away if the identification step didn’t give any result, but the system is still suspected of being compromised.","status":"Waiting","flag":false,"order":9,"extraData":{}},{"_id":"~1966149864","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154570,"title":"Capitalize","group":"Aftermath","description":"Actions to improve the Unix/Linux intrusion detection management processes should be defined to capitalize on this experience.","status":"Waiting","flag":false,"order":14,"extraData":{}},{"_id":"~2457718928","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154538,"title":"Unusual services","group":"Identification","description":"(Linux only) Run chkconfig (if installed) to check for all enabled services:\n\n```\n# chkconfig --list\n```\n\nLook at the running processes (remember: a rootkit might change your results for everything in this paper, especially here!).\n\n```\n# ps -aux\n```\n\nUse on unknown processes:\n\n```\nlsof –p [pid] \n```\n\nYou should know your usual running processes, and be able to figure out which processes could have been added by a hacker. \nPay a special attention to the processes running under UID 0.","status":"Waiting","flag":false,"order":3,"extraData":{}},{"_id":"~2457723024","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154539,"title":"Unusual Network Activity","group":"Identification","description":"Try to detect sniffers on the network using several ways:\n\nLook at your kernel log files for interfaces entering promiscuous mode such as :“kernel: device eth0 entered promiscuous mode”\n\nUse # ip link to detect the “PROMISC” flag. Prefer this method to ifconfig, since ifconfig does not work on all kernels.\n- Look for unusual port activity: *# netstat –nap* and *# lsof –i * to get more information about processes listening to ports.\n- Look for unusual MAC entries in your LAN: *# arp -a*\n- Look for any unexpected IP address on the network.","status":"Waiting","flag":false,"order":4,"extraData":{}},{"_id":"~2457727120","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154540,"title":"Unusual automated tasks","group":"Identification","description":"- Look for unusual jobs scheduled by users mentioned in /etc/cron.allow. Pay a special attention to the cron jobs scheduled by UID 0 accounts (root):\n\n```\n# crontab –u root -l\n```\n\n- Look for unusual system-wide cron jobs: \n\n```\n# cat /etc/crontab\n```\n\nand \n```\n# ls –la /etc/cron.*\n```","status":"Waiting","flag":false,"order":5,"extraData":{}},{"_id":"~2539606016","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154544,"title":"Unusual Kernel log Entries","group":"Identification","description":"- Look through the kernel log files on the system for suspicious events. Use :\n\n```\n# dmesg\n```\n\nList all important kernel and system information : \n\n```\n# lsmod\n# lspci\n```\n\n- Look for known rootkit(use rkhunter and such tools)","status":"Waiting","flag":false,"order":7,"extraData":{}},{"_id":"~3194941608","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154537,"title":"Unusual files","group":"Identification","description":"- Look for all SUID and GUID files:\n\n```\nfind / -uid 0 \\( –perm -4000 –o –perm 2000 \\) –print\n```\n\n- Look for weird file names ,starting with “.“ or “..“ or ““ :\n\n```\n# find / -name “ *“ –print\n# find / -name “. *“ –print\n# find / -name “.. *“ –print\n```\n\n- Look for large files(here: larger than 10MB)\n\n```\n# find / -size +10MB –print\n```\n\n- Look for processes running from or to files which have been unlinked :\n\n```\n# lsof +L1\n```\n- Look for unusual files in /proc and /tmp. This last directory is a place of choice for hackers to store data or malicious binaries.","status":"Waiting","flag":false,"order":2,"extraData":{}},{"_id":"~3194945704","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154541,"title":"Unusual Log Entries","group":"Identification","description":"Look through the log files on the system for suspicious events, including the following:\n- Huge number of authentication/login failures from local or remote access tools (sshd,ftpd,etc.)\n- Remote Procedure Call (RPC) programs with a log entry that includes a large number of strange characters ...)\n- A huge number of Apache logs mentioning “error” - Reboots (Hardware reboot)\n- Restart of applications (Software reboot)\n\nAlmost all log files are located under /var/log directory in most Linux distributions. Here are the main ones:\n- /var/log/message: General message and system related stuff /var/log/auth.log: Authenication logs\n- /var/log/kern.log: Kernel logs\n- /var/log/cron.log: Crond logs (cron job)\n- /var/log/maillog: Mail server logs\n- /var/log/httpd/: Apache access and error logs directory /var/log/boot.log: System boot log /var/log/mysqld.log: MySQL database server log file /var/log/secure: Authentication log\n- /var/log/utmp or /var/log/wtmp: Login records file\n\nTo look through the log files, tools like cat and grep may be useful:\n\n```\ncat /var/log/httpd/access.log | grep \"GET /signup.jsp\"\n```","status":"Waiting","flag":false,"order":6,"extraData":{}},{"_id":"~3235918048","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154549,"title":"Remediation","group":"Remediation","description":"Temporary remove all accesses to the accounts involved in the incident, and remove all fraudulent files.","status":"Waiting","flag":false,"order":11,"extraData":{}},{"_id":"~3235922144","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154550,"title":"Recovery","group":"Recovery","description":"No matter how far the hacker has gone into the system and the knowledge you might have about the compromission, as long as the system has been penetrated, the best practice is to reinstall the system completely and apply all security fixes.\n\n In case this solution can’t be applied, you should:\n- Change all the system’s accounts passwords, and make your users do so in a secure way: they should use passwords with upper/lower case, special characters, numbers, and at least be 7 characters long.\n- Check the integrity of the whole data stored on the system, using MD5 hashes.\n- Restore all binaries which could have been changed (Example: /bin/su)","status":"Waiting","flag":false,"order":12,"extraData":{}},{"_id":"~3317805232","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154535,"title":"Preparation","group":"Preparation","description":"- A physical access to the suspicious system should be offered to the forensic investigator.\n- A physical copy of the hard-disk might be necessary for forensic and evidence purposes. If needed, a physical access could be necessary to disconnect the suspected machine from any network.\n- A good knowledge of the usual network activity of the machine/server is needed. You should have a file on a secure place describing the usual port activity, to compare efficiently to the current state.\n- A good knowledge of the usual services is needed. Don’t hesitate to ask a Unix/Linux Expert for his assistance, when applicable.\n- You should have a regularly updated list of all critical files, (especially SUID and GUID files) stored in a secure place out of the network or even on paper. With this list, you can easily separate usual SUID files and detect unusual ones.\n- Have a map of your usual port activity/traffic rules.","status":"Waiting","flag":false,"order":0,"extraData":{}},{"_id":"~3317809328","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154564,"title":"Report","group":"Aftermath","description":"A crisis report should be written and made available to all of the actors of the crisis management cell. The following themes should be described:\n- Initial detection\n- Actions and timelines \n- What went right\n- What went wrong\n- Incident cost","status":"Waiting","flag":false,"order":13,"extraData":{}},{"_id":"~3604570248","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154548,"title":"Find evidences of every action of the hacker","group":"Containment","description":"Try to find evidences of every action of the hacker: (using forensic tools like Sleuth Kit/Autopsy for example)\n\n- Find all files used by the attacker, including deleted files and see what has been done with them or at least their functionality to evaluate the threat.\n- Check all files accessed recently.\n- Check log files.\n- More generally, try to find how the attacker got into the system. All leads should be considered. If no computer proof of the intrusion is found, never forget it could come from an insider.\n- Apply fixes when applicable, to prevent the same kind of intrusion, in case the attacker used a known fixed vulnerability.","status":"Waiting","flag":false,"order":10,"extraData":{}},{"_id":"~3932213336","_type":"Task","_createdBy":"florian@strangebee.com","_createdAt":1652087154536,"title":"Unusual accounts","group":"Identification","description":"Look for any suspicious entry in /etc/passwd, especially with UID 0. Also check /etc/group and /etc/shadow.\n\nLook for orphaned files, which could have been left by a deleted account used in the attack:\n\n```\nfind / \\( -nouser –o –nogroup \\) -print\n```","status":"Waiting","flag":false,"order":1,"extraData":{}}]}